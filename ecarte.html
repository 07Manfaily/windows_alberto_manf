import React, { useState, useRef } from 'react';
import { Plus, Edit2, Trash2, Eye, X, Check, AlertCircle, CheckCircle, FileText } from 'lucide-react';

const QuizManager = () => {
  const [quizzes, setQuizzes] = useState([]);
  const [currentView, setCurrentView] = useState('list');
  const [editingQuiz, setEditingQuiz] = useState(null);
  const formDialogRef = useRef(null);
  const deleteDialogRef = useRef(null);
  const [deleteIndex, setDeleteIndex] = useState(null);
  const CODE_FORMATION = 'FORM-2025-JS';
  const [formData, setFormData] = useState({ quiz: '', type: 'free', modalities: [], mandatory: true });
  const [currentModality, setCurrentModality] = useState('');
  const [formAnswers, setFormAnswers] = useState({});

  const openFormDialog = (index = null) => {
    if (index !== null) {
      setFormData(quizzes[index]);
      setEditingQuiz(index);
    } else {
      resetForm();
      setEditingQuiz(null);
    }
    formDialogRef.current?.showModal();
  };

  const closeFormDialog = () => {
    formDialogRef.current?.close();
    resetForm();
  };

  const openDeleteDialog = (index) => {
    setDeleteIndex(index);
    deleteDialogRef.current?.showModal();
  };

  const closeDeleteDialog = () => {
    deleteDialogRef.current?.close();
    setDeleteIndex(null);
  };

  const handleAddModality = (e) => {
    if (e.key === 'Enter' && currentModality.trim()) {
      e.preventDefault();
      if (!formData.modalities.includes(currentModality.trim())) {
        setFormData({ ...formData, modalities: [...formData.modalities, currentModality.trim()] });
      }
      setCurrentModality('');
    }
  };

  const removeModality = (index) => {
    setFormData({ ...formData, modalities: formData.modalities.filter((_, i) => i !== index) });
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!formData.quiz) {
      alert('Veuillez remplir le nom du quiz');
      return;
    }
    if (editingQuiz !== null) {
      const updatedQuizzes = [...quizzes];
      updatedQuizzes[editingQuiz] = { ...formData, code_formation: CODE_FORMATION, id: Date.now() };
      setQuizzes(updatedQuizzes);
    } else {
      setQuizzes([...quizzes, { ...formData, code_formation: CODE_FORMATION, id: Date.now() }]);
    }
    closeFormDialog();
  };

  const confirmDelete = () => {
    if (deleteIndex !== null) {
      setQuizzes(quizzes.filter((_, i) => i !== deleteIndex));
    }
    closeDeleteDialog();
  };

  const resetForm = () => {
    setFormData({ quiz: '', type: 'free', modalities: [], mandatory: true });
    setCurrentModality('');
    setEditingQuiz(null);
  };

  const handleAnswerChange = (quizId, value) => {
    setFormAnswers({ ...formAnswers, [quizId]: value });
  };

  const handleModalityChange = (quizId, modality, checked, type) => {
    if (type === 'qcu') {
      setFormAnswers({ ...formAnswers, [quizId]: checked ? modality : null });
    } else {
      const current = formAnswers[quizId] || [];
      if (checked) {
        setFormAnswers({ ...formAnswers, [quizId]: [...current, modality] });
      } else {
        setFormAnswers({ ...formAnswers, [quizId]: current.filter(m => m !== modality) });
      }
    }
  };

  const handleSubmitFormation = () => {
    const mandatoryQuizzes = quizzes.filter(q => q.mandatory);
    const unanswered = mandatoryQuizzes.filter(q => {
      const answer = formAnswers[q.id];
      return !answer || (Array.isArray(answer) && answer.length === 0);
    });

    if (unanswered.length > 0) {
      alert(`Veuillez r√©pondre aux quiz obligatoires: ${unanswered.map(q => q.quiz).join(', ')}`);
      return;
    }

    alert('‚úÖ Formation soumise avec succ√®s!\n\nR√©ponses: ' + JSON.stringify(formAnswers, null, 2));
  };

  if (currentView === 'formation') {
    return (
      <div style={{ minHeight: '100vh', backgroundColor: '#f8f9fa', display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
        <div style={{ 
          background: 'linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%)',
          padding: '40px 20px',
          boxShadow: '0 4px 6px rgba(0,0,0,0.1)',
          width: '100%',
          maxWidth: '900px',
          borderRadius: '0 0 12px 12px'
        }}>
          <div style={{ 
            textAlign: 'center'
          }}>
            <div style={{ 
              display: 'inline-flex', 
              alignItems: 'center', 
              gap: '15px', 
              marginBottom: '20px' 
            }}>
              <div style={{ 
                width: '50px', 
                height: '50px', 
                backgroundColor: '#ef4444', 
                borderRadius: '8px' 
              }}></div>
              <div style={{ textAlign: 'left' }}>
                <div style={{ 
                  fontSize: '13px', 
                  color: 'rgba(255,255,255,0.9)', 
                  fontWeight: '600', 
                  letterSpacing: '1px' 
                }}>
                  SOCI√âT√â G√âN√âRALE
                </div>
                <div style={{ 
                  fontSize: '12px', 
                  color: 'rgba(255,255,255,0.8)' 
                }}>
                  C√îTE D'IVOIRE
                </div>
              </div>
            </div>
            <h1 style={{ 
              fontSize: '42px', 
              fontWeight: '800', 
              color: 'white', 
              margin: '0',
              letterSpacing: '-0.5px'
            }}>
              FORMATION DU QUIZ
            </h1>
            <div style={{ 
              width: '100px', 
              height: '4px', 
              backgroundColor: '#ef4444', 
              marginTop: '15px',
              marginLeft: 'auto',
              marginRight: 'auto'
            }}></div>
          </div>
        </div>

        <div style={{ 
          maxWidth: '900px', 
          width: '100%',
          padding: '30px 20px' 
        }}>
          <button 
            onClick={() => setCurrentView('list')} 
            style={{ 
              marginBottom: '30px', 
              padding: '12px 24px', 
              backgroundColor: 'white', 
              color: '#1e3a8a', 
              border: '2px solid #e5e7eb', 
              borderRadius: '8px', 
              cursor: 'pointer', 
              fontSize: '15px', 
              fontWeight: '600',
              boxShadow: '0 2px 4px rgba(0,0,0,0.05)'
            }}
          >
            ‚Üê Retour √† la gestion
          </button>

          {quizzes.length === 0 ? (
            <div style={{ 
              textAlign: 'center', 
              padding: '80px 20px', 
              backgroundColor: 'white', 
              borderRadius: '12px', 
              border: '1px solid #e5e7eb' 
            }}>
              <div style={{ fontSize: '64px', marginBottom: '20px' }}>üìù</div>
              <h3 style={{ fontSize: '24px', color: '#1f2937', marginBottom: '12px' }}>
                Aucun quiz dans cette formation
              </h3>
              <p style={{ fontSize: '16px', color: '#6b7280' }}>
                Retournez √† la gestion pour cr√©er des quiz
              </p>
            </div>
          ) : (
            <>
              <div style={{ 
                display: 'flex', 
                flexDirection: 'column', 
                gap: '25px',
                maxHeight: '65vh',
                overflowY: 'auto',
                paddingRight: '10px'
              }}>
                {quizzes.map((quiz, quizIndex) => (
                  <div 
                    key={quiz.id} 
                    style={{ 
                      backgroundColor: 'white', 
                      borderRadius: '12px', 
                      border: '2px solid #e5e7eb',
                      overflow: 'hidden',
                      boxShadow: '0 2px 8px rgba(0,0,0,0.05)'
                    }}
                  >
                    <div style={{ 
                      padding: '20px 25px', 
                      backgroundColor: '#f8f9fa',
                      borderBottom: '2px solid #e5e7eb',
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center'
                    }}>
                      <div style={{ flex: 1 }}>
                        <div style={{ 
                          fontSize: '24px', 
                          fontWeight: '700', 
                          color: '#1f2937',
                          marginBottom: '8px'
                        }}>
                          {quiz.quiz}
                        </div>
                        <div style={{ display: 'flex', gap: '10px', alignItems: 'center', flexWrap: 'wrap' }}>
                          <span style={{ 
                            padding: '4px 12px', 
                            backgroundColor: '#e0e7ff', 
                            color: '#3b82f6', 
                            borderRadius: '6px', 
                            fontSize: '12px', 
                            fontWeight: '600',
                            textTransform: 'uppercase'
                          }}>
                            {quiz.type}
                          </span>
                          {quiz.mandatory && (
                            <span style={{ 
                              padding: '4px 12px', 
                              backgroundColor: '#fee2e2', 
                              color: '#dc2626', 
                              borderRadius: '6px', 
                              fontSize: '12px', 
                              fontWeight: '600',
                              display: 'flex',
                              alignItems: 'center',
                              gap: '4px'
                            }}>
                              <AlertCircle size={14} />
                              OBLIGATOIRE
                            </span>
                          )}
                        </div>
                      </div>
                    </div>

                    <div style={{ padding: '25px' }}>
                      {quiz.type === 'free' && (
                        <div>
                          <label style={{ 
                            display: 'block', 
                            fontSize: '15px', 
                            fontWeight: '600', 
                            color: '#374151',
                            marginBottom: '12px'
                          }}>
                            Votre r√©ponse {quiz.mandatory && <span style={{ color: '#ef4444' }}>*</span>}
                          </label>
                          <textarea 
                            value={formAnswers[quiz.id] || ''}
                            onChange={(e) => handleAnswerChange(quiz.id, e.target.value)}
                            placeholder="√âcrivez votre r√©ponse ici..."
                            rows={5}
                            style={{ 
                              width: '100%', 
                              padding: '14px', 
                              border: '2px solid #e5e7eb', 
                              borderRadius: '8px', 
                              fontSize: '15px', 
                              boxSizing: 'border-box', 
                              outline: 'none', 
                              fontFamily: 'inherit', 
                              resize: 'vertical',
                              backgroundColor: '#fafafa'
                            }} 
                          />
                        </div>
                      )}

                      {(quiz.type === 'qcm' || quiz.type === 'qcu') && quiz.modalities.length > 0 && (
                        <div>
                          <div style={{ 
                            fontSize: '15px', 
                            fontWeight: '600', 
                            color: '#374151',
                            marginBottom: '14px'
                          }}>
                            {quiz.type === 'qcu' ? 'Choisissez une r√©ponse' : 'Choisissez une ou plusieurs r√©ponses'}
                            {quiz.mandatory && <span style={{ color: '#ef4444' }}> *</span>}
                          </div>
                          <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                            {quiz.modalities.map((modality, idx) => {
                              const isChecked = quiz.type === 'qcu' 
                                ? formAnswers[quiz.id] === modality
                                : (formAnswers[quiz.id] || []).includes(modality);
                              
                              return (
                                <label 
                                  key={idx}
                                  style={{ 
                                    display: 'flex', 
                                    alignItems: 'center', 
                                    gap: '12px', 
                                    padding: '14px 18px', 
                                    backgroundColor: isChecked ? '#eff6ff' : '#fafafa',
                                    border: isChecked ? '2px solid #3b82f6' : '2px solid #e5e7eb',
                                    borderRadius: '8px', 
                                    cursor: 'pointer',
                                    transition: 'all 0.2s'
                                  }}
                                >
                                  <input 
                                    type={quiz.type === 'qcu' ? 'radio' : 'checkbox'}
                                    name={`quiz-${quiz.id}`}
                                    checked={isChecked}
                                    onChange={(e) => handleModalityChange(quiz.id, modality, e.target.checked, quiz.type)}
                                    style={{ 
                                      width: '18px', 
                                      height: '18px', 
                                      cursor: 'pointer',
                                      accentColor: '#3b82f6'
                                    }} 
                                  />
                                  <span style={{ 
                                    fontSize: '15px', 
                                    color: '#1f2937',
                                    fontWeight: isChecked ? '600' : '500',
                                    flex: 1
                                  }}>
                                    {modality}
                                  </span>
                                  {isChecked && <Check size={18} color="#3b82f6" />}
                                </label>
                              );
                            })}
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                ))}
              </div>

              <div style={{ 
                marginTop: '30px', 
                padding: '25px', 
                backgroundColor: 'white', 
                borderRadius: '12px',
                border: '2px solid #e5e7eb',
                textAlign: 'center'
              }}>
                <button 
                  onClick={handleSubmitFormation}
                  style={{ 
                    padding: '14px 40px', 
                    backgroundColor: '#3b82f6', 
                    color: 'white', 
                    border: 'none', 
                    borderRadius: '8px', 
                    cursor: 'pointer', 
                    fontSize: '17px', 
                    fontWeight: '700',
                    boxShadow: '0 4px 12px rgba(59,130,246,0.3)',
                    display: 'inline-flex',
                    alignItems: 'center',
                    gap: '10px'
                  }}
                >
                  <Check size={22} />
                  Soumettre la Formation
                </button>
              </div>
            </>
          )}
        </div>
      </div>
    );
  }

  return (
    <div style={{ padding: '40px 20px', maxWidth: '1400px', margin: '0 auto', fontFamily: 'system-ui, sans-serif', backgroundColor: '#f3f4f6', minHeight: '100vh' }}>
      <dialog ref={formDialogRef} style={{ padding: 0, border: 'none', borderRadius: '20px', maxWidth: '700px', width: '90%', boxShadow: '0 20px 60px rgba(0,0,0,0.3)', backgroundColor: 'white' }}>
        <div style={{ backgroundColor: 'white', padding: '40px', borderRadius: '20px' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
            <h2 style={{ fontSize: '32px', fontWeight: '800', color: '#1f2937', margin: 0 }}>{editingQuiz !== null ? 'Modifier le Quiz' : 'Nouveau Quiz'}</h2>
            <button onClick={closeFormDialog} style={{ background: 'none', border: 'none', cursor: 'pointer', padding: '8px', borderRadius: '8px', display: 'flex', alignItems: 'center' }}><X size={24} color="#6b7280" /></button>
          </div>
          <p style={{ color: '#6b7280', marginBottom: '32px', fontSize: '14px' }}>Formation: {CODE_FORMATION}</p>
          <div>
            <div style={{ marginBottom: '24px' }}>
              <label style={{ display: 'block', marginBottom: '10px', fontWeight: '700', color: '#1f2937', fontSize: '15px' }}>Nom du Quiz</label>
              <input type="text" value={formData.quiz} onChange={(e) => setFormData({ ...formData, quiz: e.target.value })} placeholder="Ex: Quiz JavaScript - Les Bases" style={{ width: '100%', padding: '14px 16px', border: '2px solid #e5e7eb', borderRadius: '12px', fontSize: '16px', boxSizing: 'border-box', outline: 'none', fontFamily: 'inherit' }} />
            </div>
            <div style={{ marginBottom: '24px' }}>
              <label style={{ display: 'block', marginBottom: '10px', fontWeight: '700', color: '#1f2937', fontSize: '15px' }}>Type de Quiz</label>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '12px' }}>
                <label style={{ padding: '16px', backgroundColor: formData.type === 'free' ? '#e0e7ff' : '#f9fafb', border: formData.type === 'free' ? '2px solid #3b82f6' : '2px solid #e5e7eb', borderRadius: '12px', cursor: 'pointer', textAlign: 'center' }}>
                  <input type="radio" name="type" value="free" checked={formData.type === 'free'} onChange={(e) => setFormData({ ...formData, type: e.target.value })} style={{ display: 'none' }} />
                  <div style={{ fontWeight: '700', color: formData.type === 'free' ? '#3b82f6' : '#6b7280', fontSize: '16px', marginBottom: '4px' }}>FREE</div>
                  <div style={{ fontSize: '12px', color: '#6b7280' }}>R√©ponse libre</div>
                </label>
                <label style={{ padding: '16px', backgroundColor: formData.type === 'qcm' ? '#e0e7ff' : '#f9fafb', border: formData.type === 'qcm' ? '2px solid #3b82f6' : '2px solid #e5e7eb', borderRadius: '12px', cursor: 'pointer', textAlign: 'center' }}>
                  <input type="radio" name="type" value="qcm" checked={formData.type === 'qcm'} onChange={(e) => setFormData({ ...formData, type: e.target.value })} style={{ display: 'none' }} />
                  <div style={{ fontWeight: '700', color: formData.type === 'qcm' ? '#3b82f6' : '#6b7280', fontSize: '16px', marginBottom: '4px' }}>QCM</div>
                  <div style={{ fontSize: '12px', color: '#6b7280' }}>Choix multiple</div>
                </label>
                <label style={{ padding: '16px', backgroundColor: formData.type === 'qcu' ? '#e0e7ff' : '#f9fafb', border: formData.type === 'qcu' ? '2px solid #3b82f6' : '2px solid #e5e7eb', borderRadius: '12px', cursor: 'pointer', textAlign: 'center' }}>
                  <input type="radio" name="type" value="qcu" checked={formData.type === 'qcu'} onChange={(e) => setFormData({ ...formData, type: e.target.value })} style={{ display: 'none' }} />
                  <div style={{ fontWeight: '700', color: formData.type === 'qcu' ? '#3b82f6' : '#6b7280', fontSize: '16px', marginBottom: '4px' }}>QCU</div>
                  <div style={{ fontSize: '12px', color: '#6b7280' }}>Choix unique</div>
                </label>
              </div>
            </div>
            {(formData.type === 'qcm' || formData.type === 'qcu') && (
              <div style={{ marginBottom: '24px' }}>
                <label style={{ display: 'block', marginBottom: '10px', fontWeight: '700', color: '#1f2937', fontSize: '15px' }}>Modalit√©s (Appuyez sur Entr√©e)</label>
                <input type="text" value={currentModality} onChange={(e) => setCurrentModality(e.target.value)} onKeyDown={handleAddModality} placeholder="Tapez une r√©ponse et appuyez sur Entr√©e" style={{ width: '100%', padding: '14px 16px', border: '2px solid #e5e7eb', borderRadius: '12px', fontSize: '16px', boxSizing: 'border-box', outline: 'none', fontFamily: 'inherit' }} />
                {formData.modalities.length > 0 && (
                  <div style={{ marginTop: '16px', display: 'flex', flexWrap: 'wrap', gap: '10px' }}>
                    {formData.modalities.map((mod, index) => (
                      <div key={index} style={{ display: 'inline-flex', alignItems: 'center', gap: '8px', padding: '8px 12px', backgroundColor: '#3b82f6', color: 'white', borderRadius: '8px', fontSize: '14px', fontWeight: '500' }}>
                        <span>{mod}</span>
                        <button type="button" onClick={() => removeModality(index)} style={{ background: 'rgba(255,255,255,0.2)', border: 'none', borderRadius: '4px', cursor: 'pointer', padding: '4px', color: 'white', display: 'flex', alignItems: 'center' }}><X size={14} /></button>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}
            <div style={{ marginBottom: '32px' }}>
              <label style={{ display: 'block', marginBottom: '12px', fontWeight: '700', color: '#1f2937', fontSize: '15px' }}>Ce quiz est-il obligatoire ?</label>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>
                <label style={{ padding: '18px', backgroundColor: formData.mandatory ? '#fef2f2' : '#f9fafb', border: formData.mandatory ? '2px solid #ef4444' : '2px solid #e5e7eb', borderRadius: '12px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '12px' }}>
                  <input type="radio" name="mandatory" checked={formData.mandatory === true} onChange={() => setFormData({ ...formData, mandatory: true })} style={{ width: '20px', height: '20px', cursor: 'pointer' }} />
                  <div><div style={{ fontWeight: '700', color: '#dc2626', fontSize: '15px' }}>Obligatoire</div><div style={{ fontSize: '12px', color: '#6b7280' }}>R√©ponse requise</div></div>
                </label>
                <label style={{ padding: '18px', backgroundColor: formData.mandatory === false ? '#f0f9ff' : '#f9fafb', border: formData.mandatory === false ? '2px solid #0891b2' : '2px solid #e5e7eb', borderRadius: '12px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '12px' }}>
                  <input type="radio" name="mandatory" checked={formData.mandatory === false} onChange={() => setFormData({ ...formData, mandatory: false })} style={{ width: '20px', height: '20px', cursor: 'pointer' }} />
                  <div><div style={{ fontWeight: '700', color: '#0891b2', fontSize: '15px' }}>Optionnel</div><div style={{ fontSize: '12px', color: '#6b7280' }}>Peut ignorer</div></div>
                </label>
              </div>
            </div>
            <div style={{ display: 'flex', gap: '12px' }}>
              <button onClick={closeFormDialog} style={{ flex: 1, padding: '14px', backgroundColor: '#f3f4f6', color: '#374151', border: '2px solid #e5e7eb', borderRadius: '12px', cursor: 'pointer', fontSize: '16px', fontWeight: '600' }}>Annuler</button>
              <button onClick={handleSubmit} style={{ flex: 1, padding: '14px', backgroundColor: '#3b82f6', color: 'white', border: 'none', borderRadius: '12px', cursor: 'pointer', fontSize: '16px', fontWeight: '700' }}>{editingQuiz !== null ? '‚úì Mettre √† Jour' : '+ Cr√©er'}</button>
            </div>
          </div>
        </div>
      </dialog>
      <dialog ref={deleteDialogRef} style={{ padding: 0, border: 'none', borderRadius: '16px', maxWidth: '400px', width: '90%', boxShadow: '0 20px 60px rgba(0,0,0,0.3)' }}>
        <div style={{ backgroundColor: 'white', padding: '32px', borderRadius: '16px' }}>
          <div style={{ textAlign: 'center', marginBottom: '24px' }}>
            <div style={{ fontSize: '48px', marginBottom: '16px' }}>‚ö†Ô∏è</div>
            <h3 style={{ fontSize: '24px', fontWeight: '700', color: '#1f2937', marginBottom: '8px' }}>Confirmer la suppression</h3>
            <p style={{ fontSize: '16px', color: '#6b7280' }}>√ätes-vous s√ªr de vouloir supprimer ce quiz ? Cette action est irr√©versible.</p>
          </div>
          <div style={{ display: 'flex', gap: '12px' }}>
            <button onClick={closeDeleteDialog} style={{ flex: 1, padding: '12px', backgroundColor: '#f3f4f6', color: '#374151', border: '2px solid #e5e7eb', borderRadius: '10px', cursor: 'pointer', fontSize: '16px', fontWeight: '600' }}>Annuler</button>
            <button onClick={confirmDelete} style={{ flex: 1, padding: '12px', backgroundColor: '#ef4444', color: 'white', border: 'none', borderRadius: '10px', cursor: 'pointer', fontSize: '16px', fontWeight: '600' }}>Supprimer</button>
          </div>
        </div>
      </dialog>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '40px', flexWrap: 'wrap', gap: '20px' }}>
        <div>
          <h1 style={{ fontSize: '42px', fontWeight: '800', color: '#1f2937', margin: '0 0 8px 0' }}>Quiz Manager</h1>
          <p style={{ fontSize: '16px', color: '#6b7280', margin: 0 }}>Formation: {CODE_FORMATION}</p>
        </div>
        <div style={{ display: 'flex', gap: '12px' }}>
          <button 
            onClick={() => setCurrentView('formation')} 
            style={{ 
              display: 'flex', 
              alignItems: 'center', 
              gap: '10px', 
              padding: '14px 28px', 
              backgroundColor: '#10b981', 
              color: 'white', 
              border: 'none', 
              borderRadius: '12px', 
              cursor: 'pointer', 
              fontSize: '16px', 
              fontWeight: '700', 
              boxShadow: '0 2px 8px rgba(16,185,129,0.3)' 
            }}
          >
            <FileText size={22} />
            Voir la Formation
          </button>
          <button onClick={() => openFormDialog()} style={{ display: 'flex', alignItems: 'center', gap: '10px', padding: '14px 28px', backgroundColor: '#3b82f6', color: 'white', border: 'none', borderRadius: '12px', cursor: 'pointer', fontSize: '16px', fontWeight: '700', boxShadow: '0 2px 8px rgba(59,130,246,0.3)' }}><Plus size={22} />Cr√©er un Quiz</button>
        </div>
      </div>
      {quizzes.length === 0 ? (
        <div style={{ textAlign: 'center', padding: '80px 20px', backgroundColor: 'white', borderRadius: '20px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)', border: '1px solid #e5e7eb' }}>
          <div style={{ fontSize: '64px', marginBottom: '20px' }}>üìù</div>
          <h3 style={{ fontSize: '24px', color: '#1f2937', marginBottom: '12px' }}>Aucun quiz disponible</h3>
          <p style={{ fontSize: '16px', color: '#6b7280' }}>Commencez par cr√©er votre premier quiz</p>
        </div>
      ) : (
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(380px, 1fr))', gap: '24px' }}>
          {quizzes.map((quiz, index) => (
            <div key={quiz.id} style={{ backgroundColor: 'white', borderRadius: '16px', overflow: 'hidden', boxShadow: '0 2px 8px rgba(0,0,0,0.1)', border: '1px solid #e5e7eb', transition: 'transform 0.2s' }}>
              <div style={{ padding: '24px', borderBottom: '2px solid #e5e7eb' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '12px' }}>
                  <h3 style={{ fontSize: '22px', fontWeight: '700', margin: '0', flex: 1, color: '#1f2937' }}>{quiz.quiz}</h3>
                  {quiz.mandatory ? <AlertCircle size={24} color="#dc2626" /> : <CheckCircle size={24} color="#0891b2" />}
                </div>
                <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                  <span style={{ padding: '4px 10px', backgroundColor: '#f3f4f6', color: '#6b7280', borderRadius: '6px', fontSize: '12px', fontWeight: '600', textTransform: 'uppercase' }}>{quiz.type}</span>
                  {quiz.type !== 'free' && <span style={{ padding: '4px 10px', backgroundColor: '#f3f4f6', color: '#6b7280', borderRadius: '6px', fontSize: '12px', fontWeight: '600' }}>{quiz.modalities.length} questions</span>}
                </div>
              </div>
              <div style={{ padding: '20px' }}>
                <div style={{ padding: '12px', backgroundColor: quiz.mandatory ? '#fef2f2' : '#f0f9ff', borderRadius: '8px', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                  {quiz.mandatory ? <><AlertCircle size={16} style={{ color: '#dc2626' }} /><span style={{ fontSize: '13px', fontWeight: '600', color: '#dc2626' }}>Quiz Obligatoire</span></> : <><CheckCircle size={16} style={{ color: '#0891b2' }} /><span style={{ fontSize: '13px', fontWeight: '600', color: '#0891b2' }}>Quiz Optionnel</span></>}
                </div>
                <div style={{ display: 'flex', gap: '8px' }}>
                  <button onClick={() => openFormDialog(index)} style={{ flex: 1, padding: '10px', backgroundColor: '#f59e0b', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '14px', fontWeight: '600', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '6px' }}><Edit2 size={16} />Modifier</button>
                  <button onClick={() => openDeleteDialog(index)} style={{ padding: '10px 14px', backgroundColor: '#ef4444', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' }}><Trash2 size={16} /></button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default QuizManager;
