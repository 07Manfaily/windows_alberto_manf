import React, { useState, useEffect } from 'react';

// Utilitaires pour g√©n√©rer les couleurs
const colorUtils = {
  // Couleur bas√©e sur le nom (toujours la m√™me pour un nom donn√©)
  getColorFromName: (name) => {
    let hash = 0;
    for (let i = 0; i < name.length; i++) {
      hash = name.charCodeAt(i) + ((hash << 5) - hash);
    }
    const hue = Math.abs(hash % 360);
    const saturation = 65 + (Math.abs(hash) % 20); // 65-85%
    const lightness = 45 + (Math.abs(hash) % 15);  // 45-60%
    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
  },

  // Couleur compl√®tement al√©atoire
  getRandomColor: () => {
    const hue = Math.floor(Math.random() * 360);
    const saturation = 60 + Math.floor(Math.random() * 25); // 60-85%
    const lightness = 45 + Math.floor(Math.random() * 15);  // 45-60%
    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
  },

  // Palette de couleurs pr√©d√©finies
  colorPalette: [
    '#e74c3c', '#3498db', '#2ecc71', '#f39c12', 
    '#9b59b6', '#1abc9c', '#e67e22', '#34495e',
    '#f1c40f', '#e91e63', '#9c27b0', '#673ab7',
    '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4',
    '#ff5722', '#795548', '#607d8b', '#ff9800'
  ],

  getPresetColor: (index) => {
    return colorUtils.colorPalette[index % colorUtils.colorPalette.length];
  }
};

// Fonction pour extraire les initiales
const getInitials = (name) => {
  if (!name) return '??';
  
  return name
    .split(' ')
    .map(word => word.charAt(0).toUpperCase())
    .join('')
    .substring(0, 2);
};

// Composant Avatar
const Avatar = ({ participant, colorMethod = 'name-based', index = 0 }) => {
  const initials = getInitials(participant.name || participant.firstName + ' ' + participant.lastName);
  
  let backgroundColor;
  switch (colorMethod) {
    case 'random':
      backgroundColor = colorUtils.getRandomColor();
      break;
    case 'preset':
      backgroundColor = colorUtils.getPresetColor(index);
      break;
    case 'name-based':
    default:
      backgroundColor = colorUtils.getColorFromName(participant.name || participant.firstName + ' ' + participant.lastName);
      break;
  }

  return (
    <div
      className="avatar"
      style={{
        backgroundColor,
        width: '50px',
        height: '50px',
        borderRadius: '50%',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        color: 'white',
        fontWeight: 'bold',
        fontSize: '16px',
        margin: '4px',
        boxShadow: '0 2px 8px rgba(0,0,0,0.15)',
        cursor: 'pointer',
        transition: 'transform 0.2s'
      }}
      onMouseEnter={(e) => e.target.style.transform = 'scale(1.1)'}
      onMouseLeave={(e) => e.target.style.transform = 'scale(1)'}
      title={participant.name || `${participant.firstName} ${participant.lastName}`}
    >
      {initials}
    </div>
  );
};

// Composant principal
const ParticipantAvatars = () => {
  const [participants, setParticipants] = useState([]);
  const [loading, setLoading] = useState(true);
  const [colorMethod, setColorMethod] = useState('name-based');

  // Simulation d'une API call
  const fetchParticipants = async () => {
    setLoading(true);
    
    // Simuler un d√©lai d'API
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // Donn√©es simul√©es - remplacez par votre vraie API
    const mockData = [
      { id: 1, name: "Marie Dupont", email: "marie@example.com" },
      { id: 2, firstName: "Jean", lastName: "Martin", email: "jean@example.com" },
      { id: 3, name: "Sophie Bernard", email: "sophie@example.com" },
      { id: 4, firstName: "Pierre", lastName: "Durand", email: "pierre@example.com" },
      { id: 5, name: "Anna Lefebvre", email: "anna@example.com" },
      { id: 6, firstName: "Marc", lastName: "Roux", email: "marc@example.com" },
      { id: 7, name: "Julie Moreau", email: "julie@example.com" },
      { id: 8, firstName: "Thomas", lastName: "Simon", email: "thomas@example.com" }
    ];
    
    setParticipants(mockData);
    setLoading(false);
  };

  // Votre vraie fonction API ressemblerait √† √ßa :
  /*
  const fetchParticipants = async () => {
    setLoading(true);
    try {
      const response = await fetch('/api/participants');
      const data = await response.json();
      setParticipants(data);
    } catch (error) {
      console.error('Erreur lors du chargement des participants:', error);
    } finally {
      setLoading(false);
    }
  };
  */

  useEffect(() => {
    fetchParticipants();
  }, []);

  if (loading) {
    return (
      <div style={{ textAlign: 'center', padding: '40px' }}>
        <div style={{ 
          width: '40px', 
          height: '40px', 
          border: '4px solid #f3f3f3',
          borderTop: '4px solid #3498db',
          borderRadius: '50%',
          animation: 'spin 1s linear infinite',
          margin: '0 auto 20px'
        }}></div>
        <p>Chargement des participants...</p>
        <style>
          {`
            @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
          `}
        </style>
      </div>
    );
  }

  return (
    <div style={{ 
      maxWidth: '800px', 
      margin: '0 auto', 
      padding: '20px',
      fontFamily: 'system-ui, -apple-system, sans-serif'
    }}>
      <h1 style={{ textAlign: 'center', color: '#2c3e50', marginBottom: '30px' }}>
        üé® Avatars des Participants
      </h1>

      {/* Contr√¥les */}
      <div style={{ 
        marginBottom: '30px', 
        padding: '20px', 
        backgroundColor: '#f8f9fa', 
        borderRadius: '8px',
        display: 'flex',
        gap: '15px',
        flexWrap: 'wrap',
        alignItems: 'center'
      }}>
        <label style={{ fontWeight: 'bold', color: '#34495e' }}>
          M√©thode de couleur :
        </label>
        
        <button
          onClick={() => setColorMethod('name-based')}
          style={{
            padding: '8px 16px',
            border: 'none',
            borderRadius: '6px',
            backgroundColor: colorMethod === 'name-based' ? '#3498db' : '#ecf0f1',
            color: colorMethod === 'name-based' ? 'white' : '#34495e',
            cursor: 'pointer',
            fontSize: '14px'
          }}
        >
          Bas√©e sur le nom
        </button>
        
        <button
          onClick={() => setColorMethod('preset')}
          style={{
            padding: '8px 16px',
            border: 'none',
            borderRadius: '6px',
            backgroundColor: colorMethod === 'preset' ? '#3498db' : '#ecf0f1',
            color: colorMethod === 'preset' ? 'white' : '#34495e',
            cursor: 'pointer',
            fontSize: '14px'
          }}
        >
          Palette pr√©d√©finie
        </button>
        
        <button
          onClick={() => setColorMethod('random')}
          style={{
            padding: '8px 16px',
            border: 'none',
            borderRadius: '6px',
            backgroundColor: colorMethod === 'random' ? '#3498db' : '#ecf0f1',
            color: colorMethod === 'random' ? 'white' : '#34495e',
            cursor: 'pointer',
            fontSize: '14px'
          }}
        >
          Al√©atoire
        </button>

        <button
          onClick={fetchParticipants}
          style={{
            padding: '8px 16px',
            border: 'none',
            borderRadius: '6px',
            backgroundColor: '#2ecc71',
            color: 'white',
            cursor: 'pointer',
            fontSize: '14px',
            marginLeft: 'auto'
          }}
        >
          üîÑ Recharger
        </button>
      </div>

      {/* Liste des avatars */}
      <div style={{ 
        display: 'flex', 
        flexWrap: 'wrap', 
        gap: '12px',
        padding: '20px',
        backgroundColor: 'white',
        borderRadius: '12px',
        boxShadow: '0 4px 20px rgba(0,0,0,0.1)'
      }}>
        {participants.map((participant, index) => (
          <Avatar
            key={participant.id}
            participant={participant}
            colorMethod={colorMethod}
            index={index}
          />
        ))}
      </div>

      {/* Informations */}
      <div style={{ 
        marginTop: '30px', 
        padding: '20px', 
        backgroundColor: '#e8f5e8', 
        borderRadius: '8px',
        borderLeft: '4px solid #2ecc71'
      }}>
        <h3 style={{ color: '#27ae60', marginTop: 0 }}>üí° Comment utiliser :</h3>
        <ul style={{ color: '#2d5a2d', lineHeight: '1.6' }}>
          <li><strong>Bas√©e sur le nom :</strong> M√™me couleur pour chaque personne (recommand√©)</li>
          <li><strong>Palette pr√©d√©finie :</strong> Utilise des couleurs harmonieuses</li>
          <li><strong>Al√©atoire :</strong> Nouvelle couleur √† chaque chargement</li>
        </ul>
        <p style={{ color: '#2d5a2d', marginBottom: 0 }}>
          Total : <strong>{participants.length} participants</strong>
        </p>
      </div>
    </div>
  );
};

export default ParticipantAvatars;
